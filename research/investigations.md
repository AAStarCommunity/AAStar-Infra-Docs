# Popular wallets investigation
We will use and try all popular wallets to see if we can get some information about them.
Specially on gas payment and security and total UX.

## Overview
### 以太坊Gas Payment机制详尽调查分析

以下是对以太坊Gas支付机制的全面分析，涵盖TOP20钱包、去中心化交易所（DEX）及其他Web3应用的支付方式，结合关键EIP的变化与调整，分析影响Gas支付流程和成本的关键因素，并探讨针对外部账户（EOA）和合约账户（CA）的改进措施及其产品应用，最后评价这些改进在Gas支付方面的提升与不足。

---

### 一、以太坊Gas Payment机制概述

在以太坊网络中，Gas是衡量计算资源消耗的单位，用于支付交易和智能合约执行的费用。Gas支付机制的核心目的是防止网络资源滥用，确保每一笔操作都有明确的经济成本。其基本流程如下：
1. **Gas Limit**：用户指定每笔交易愿意消耗的最大Gas量。
2. **Gas Price**：用户设定每单位Gas愿意支付的价格（以Gwei为单位）。
3. **交易费用**：计算公式为 `Gas Used × Gas Price`，以ETH支付。
4. **矿工/验证者激励**：在工作量证明（PoW）时期，矿工优先打包Gas价格高的交易；权益证明（PoS）后，验证者遵循类似逻辑。

Gas支付直接影响用户体验，尤其在网络拥堵时，高Gas费用成为瓶颈。以下分析TOP20钱包、DEX和Web3应用的Gas支付方式及其演变。

---

### 二、TOP20钱包、DEX和Web3应用的Gas Payment支付方式

#### 1. TOP20钱包的Gas支付方式
根据市场份额和用户量，以下是部分TOP20钱包（MetaMask、OKX Wallet、Coinbase Wallet、Trust Wallet、imToken等）的常见Gas支付方式：
- **标准支付（ETH支付）**：
  - 用户通过钱包界面设置Gas Limit和Gas Price，直接用ETH支付。
  - 示例：MetaMask默认提供“慢速、平均、快速”三种Gas价格选项，用户可手动调整。
- **代付机制（Gasless体验）**：
  - 部分钱包通过集成智能合约或Layer 2（L2）解决方案实现“代付”。如OKX Wallet支持部分DApp的Gas代付，用户无需直接支付ETH，由DApp或第三方承担。
- **多币种支付尝试**：
  - 一些钱包（如Trust Wallet）允许用户用其他代币（如BNB在BNB Chain上）支付Gas，但以太坊主网仍限制为ETH。
- **批量交易**：
  - 支持智能合约钱包的钱包（如Gnosis Safe）允许用户在一笔交易中执行多个操作，减少多次支付Gas的成本。

#### 2. DEX的Gas支付方式
去中心化交易所（如Uniswap、SushiSwap、Curve等）的Gas支付方式与智能合约交互密切相关：
- **直接支付**：
  - 用户在Swap、添加流动性等操作时，直接支付ETH作为Gas费。例如，Uniswap V3的交易需支付Gas以执行Swap和更新池状态。
- **优化Gas路径**：
  - 一些DEX通过路由优化减少Gas消耗，如1inch通过聚合多个DEX路径降低总Gas成本。
- **L2集成**：
  - DEX逐渐迁移至L2（如Uniswap在Optimism和Arbitrum上），用户支付的Gas费用大幅降低，且部分L2支持用代币支付Gas。

#### 3. 其他Web3应用的Gas支付方式
Web3应用（如NFT市场、链游、DeFi协议）的Gas支付方式多样化：
- **原生ETH支付**：
  - OpenSea等NFT市场要求用户支付铸造、交易的Gas费，使用ETH。
- **Gas代付（Relayer模式）**：
  - 部分应用通过中继者（Relayer）代付Gas，再向用户收取其他代币或法币补偿。例如，链游Axie Infinity曾通过Ronin侧链实现免费交易。
- **预付Gas**：
  - 一些应用提前为用户预付Gas，通过积分或订阅模式回收成本。

---

### 三、关键EIP上线后的变化与调整

以太坊的Gas支付机制随EIP（以太坊改进提案）的实施不断演进，以下是几个关键EIP及其影响：

#### 1. EIP-1559（伦敦升级，2021年8月）
- **变化**：
  - 引入基础费用（Base Fee）和优先费用（Priority Fee），基础费用由网络自动调整并销毁，优先费用激励验证者。
  - 用户无需手动猜测Gas Price，钱包（如MetaMask）自动建议费用。
- **对支付方式的调整**：
  - 钱包界面简化，用户只需关注总费用而非单独设置Gas Price。
  - DEX和Web3应用因基础费用波动需优化合约调用以降低成本。
- **影响**：
  - 提高了费用可预测性，但未降低总体Gas成本，高峰期仍昂贵。

#### 2. EIP-4337（账户抽象，2023年3月上线）
- **变化**：
  - 通过不更改共识层的账户抽象方案，允许智能合约自定义签名逻辑和Gas支付规则。
- **对支付方式的调整**：
  - 钱包可实现Gas代付（如通过Bundler机制），用户无需持有ETH即可交易。
  - DEX可通过智能合约钱包批量操作，减少Gas支出。
  - Web3应用可设计“无助记词”体验，用户用其他代币支付Gas。
- **影响**：
  - 降低了新用户进入门槛，但增加了开发复杂度和链上成本。

#### 3. EIP-2938（早期账户抽象提案，未完全实施）
- **变化**：
  - 提议允许合约账户（CA）直接支付Gas，减少对EOA的依赖。
- **影响**：
  - 未上线，但为EIP-4337奠定基础，推动了智能合约钱包的发展。

#### 4. 合并（The Merge，2022年9月）
- **变化**：
  - 从PoW转向PoS，未直接改变Gas机制，但提升了网络容量。
- **影响**：
  - 间接通过分片（未来计划）降低Gas成本，钱包和应用需适配新共识。

---

### 四、影响Gas支付流程和成本的关键要素

基于上述分析，以下是影响Gas支付的关键因素：
1. **网络拥堵**：
   - 高交易量时，基础费用上升，用户支付成本增加。
2. **合约复杂度**：
   - 复杂智能合约（如多步DeFi操作）消耗更多Gas，增加费用。
3. **支付方式设计**：
   - 代付、多币种支付等方案降低用户直接成本，但需额外基础设施支持。
4. **Layer 2采用率**：
   - L2（如Arbitrum、Optimism）大幅降低Gas费，但需用户切换网络。
5. **EIP实施**：
   - EIP-1559提高了费用透明度，EIP-4337增加了支付灵活性。

---

### 五、针对EOA和合约账户的改进措施及产品应用

#### 1. EOA的改进措施
- **现状**：
  - EOA由私钥控制，只能用ETH支付Gas，缺乏灵活性。
- **改进**：
  - **账户抽象（EIP-4337）**：通过UserOperation和Bundler机制，EOA可与智能合约结合，实现自定义支付逻辑。
  - **社交恢复**：Vitalik提倡通过多签或社交恢复替代助记词管理。
- **产品应用**：
  - ** Argent**：智能合约钱包，支持社交恢复和Gas代付，用户无需持有ETH。
  - **UniPass**：基于EIP-4337的无助记词钱包，简化用户体验。

#### 2. 合约账户（CA）的改进措施
- **现状**：
  - CA无法主动发起交易或支付Gas，需EOA触发。
- **改进**：
  - **账户抽象**：允许CA定义Gas支付规则，如代付或批量交易。
  - **权限管理**：通过智能合约实现多签、限额等功能。
- **产品应用**：
  - **Gnosis Safe**：多签智能合约钱包，支持批量交易和权限控制。
  - **Safe{Wallet}**：基于EIP-4337的升级版，支持更灵活的Gas支付。

---

### 六、产品在Gas Payment的提升与缺点

#### 1. 提升
- **Argent**：
  - **提升**：Gas代付和社交恢复降低新用户门槛，集成L2（如zkSync）减少费用。
  - **缺点**：依赖中心化Relayer，增加信任成本；链上操作仍需Gas。
- **Gnosis Safe**：
  - **提升**：批量交易减少多次Gas支付，多签提升安全性。
  - **缺点**：部署和操作成本高，不适合小额用户。
- **UniPass**：
  - **提升**：无助记词设计简化使用，Gas代付提升体验。
  - **缺点**：EIP-4337生态不成熟，Bundler费用可能转嫁用户。

#### 2. 待改进之处
- **兼容性**：智能合约钱包与现有DApp的适配性不足，需开发者支持。
- **成本**：链上部署和操作的Gas费仍高，L2虽降低成本但普及率有限。
- **安全性**：代付机制引入新攻击面（如Bundler恶意行为）。
- **用户教育**：新支付方式（如账户抽象）对普通用户仍复杂。

---

### 七、结论

以太坊的Gas支付机制通过EIP-1559和EIP-4337等改进，从单一ETH支付演变为支持代付、多币种支付和批量交易的多元化体系。TOP20钱包、DEX和Web3应用正逐步采用这些创新，降低用户成本和门槛。针对EOA和CA的改进（如账户抽象）已催生Argent、Gnosis Safe等产品，显著提升支付灵活性。然而，高Gas费、兼容性问题和生态成熟度仍是挑战。未来，随着L2普及和EIP进一步实施，Gas支付流程有望更高效和用户友好，但需平衡去中心化与成本之间的权衡。

## Wallets products
- [AirWallet](https://airwallet.com/)

## Evaluation points

## Gas payment features

## Security features

## Total UX features